{
  "filename": "docker-basics.md",
  "title": "Docker基礎 - コンテナ技術入門",
  "content": "---\ntitle: Docker基礎 - コンテナ技術入門\ndate: 2025-11-08\ntags: [Docker, DevOps, Container]\n---\n\n# Docker基礎 - コンテナ技術入門\n\nDockerは、アプリケーションをコンテナとしてパッケージ化し、どの環境でも同じように実行できるようにするプラットフォームです。\n\n## Dockerとは？\n\nDockerを使うことで、開発環境と本番環境の差異をなくし、「私の環境では動くのに」問題を解決できます。\n\n### 主な概念\n\n- **イメージ**: アプリケーションとその依存関係をパッケージ化したもの\n- **コンテナ**: イメージから作成された実行可能なインスタンス\n- **Dockerfile**: イメージを構築するための設計図\n- **Docker Hub**: イメージの公開リポジトリ\n\n## Dockerfileの書き方\n\n基本的なDockerfileの例：\n\n```dockerfile\n# ベースイメージ\nFROM node:18-alpine\n\n# 作業ディレクトリの設定\nWORKDIR /app\n\n# package.json と package-lock.json をコピー\nCOPY package*.json ./\n\n# 依存関係のインストール\nRUN npm ci --only=production\n\n# アプリケーションのソースコードをコピー\nCOPY . .\n\n# ポートの公開\nEXPOSE 3000\n\n# アプリケーションの起動\nCMD [\"npm\", \"start\"]\n```\n\n## マルチステージビルド\n\n本番用イメージのサイズを小さくするテクニック：\n\n```dockerfile\n# ビルドステージ\nFROM node:18 AS builder\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nRUN npm run build\n\n# 実行ステージ\nFROM node:18-alpine\nWORKDIR /app\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY package*.json ./\nEXPOSE 3000\nCMD [\"node\", \"dist/index.js\"]\n```\n\n## Docker Composeの活用\n\n複数のコンテナを管理するための`docker-compose.yml`：\n\n```yaml\nversion: '3.8'\n\nservices:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=postgresql://db:5432/myapp\n    depends_on:\n      - db\n    volumes:\n      - ./logs:/app/logs\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_USER=admin\n      - POSTGRES_PASSWORD=secret\n      - POSTGRES_DB=myapp\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n```\n\n## よく使うDockerコマンド\n\n```bash\n# イメージのビルド\ndocker build -t myapp:latest .\n\n# コンテナの起動\ndocker run -d -p 3000:3000 --name myapp myapp:latest\n\n# 実行中のコンテナの確認\ndocker ps\n\n# コンテナのログ確認\ndocker logs myapp\n\n# コンテナに入る\ndocker exec -it myapp sh\n\n# コンテナの停止\ndocker stop myapp\n\n# コンテナの削除\ndocker rm myapp\n\n# イメージの削除\ndocker rmi myapp:latest\n\n# Docker Composeでサービスを起動\ndocker-compose up -d\n\n# Docker Composeでサービスを停止\ndocker-compose down\n```\n\n## ベストプラクティス\n\n### 1. レイヤーを最適化する\n\n変更頻度の低いコマンドを先に実行：\n\n```dockerfile\n# ✅ Good\nCOPY package*.json ./\nRUN npm install\nCOPY . .\n\n# ❌ Bad\nCOPY . .\nRUN npm install\n```\n\n### 2. .dockerignoreを活用する\n\n不要なファイルをイメージに含めない：\n\n```\nnode_modules\nnpm-debug.log\n.git\n.gitignore\n.env\n*.md\n```\n\n### 3. 軽量なベースイメージを使用する\n\n```dockerfile\n# ✅ Alpine版を使用（サイズが小さい）\nFROM node:18-alpine\n\n# ❌ 通常版（サイズが大きい）\nFROM node:18\n```\n\n### 4. セキュリティ対策\n\n```dockerfile\n# 非rootユーザーで実行\nFROM node:18-alpine\n\nRUN addgroup -g 1001 -S nodejs && \\\n    adduser -S nodejs -u 1001\n\nUSER nodejs\n\nWORKDIR /app\nCOPY --chown=nodejs:nodejs . .\n\nCMD [\"node\", \"index.js\"]\n```\n\n## イメージサイズの比較\n\n| ベースイメージ | サイズ |\n|--------------|--------|\n| node:18 | ~900 MB |\n| node:18-slim | ~200 MB |\n| node:18-alpine | ~170 MB |\n\n## トラブルシューティング\n\n### コンテナが起動しない\n\n```bash\n# ログを確認\ndocker logs <container_id>\n\n# コンテナ内に入って調査\ndocker exec -it <container_id> sh\n```\n\n### ボリュームのデータが消えた\n\n```bash\n# 名前付きボリュームを使用\ndocker volume create mydata\ndocker run -v mydata:/data myapp\n\n# ボリュームの一覧\ndocker volume ls\n```\n\n### ネットワークの問題\n\n```bash\n# ネットワークの作成\ndocker network create mynetwork\n\n# ネットワークに接続してコンテナを起動\ndocker run --network mynetwork myapp\n```\n\n## まとめ\n\nDockerは現代の開発に欠かせないツールです。基本をしっかり理解し、ベストプラクティスに従うことで、効率的な開発環境を構築できます。\n\n次のステップ：\n- Kubernetesでのオーケストレーション\n- CI/CDパイプラインへの統合\n- セキュリティスキャンの導入\n",
  "html": "<h1 id=\"docker基礎-コンテナ技術入門\">Docker基礎 - コンテナ技術入門</h1><p>Dockerは、アプリケーションをコンテナとしてパッケージ化し、どの環境でも同じように実行できるようにするプラットフォームです。</p>\n<h2 id=\"dockerとは\">Dockerとは？</h2><p>Dockerを使うことで、開発環境と本番環境の差異をなくし、「私の環境では動くのに」問題を解決できます。</p>\n<h3 id=\"主な概念\">主な概念</h3><ul>\n<li><strong>イメージ</strong>: アプリケーションとその依存関係をパッケージ化したもの</li>\n<li><strong>コンテナ</strong>: イメージから作成された実行可能なインスタンス</li>\n<li><strong>Dockerfile</strong>: イメージを構築するための設計図</li>\n<li><strong>Docker Hub</strong>: イメージの公開リポジトリ</li>\n</ul>\n<h2 id=\"dockerfileの書き方\">Dockerfileの書き方</h2><p>基本的なDockerfileの例：</p>\n<pre><code class=\"language-dockerfile\"># ベースイメージ\nFROM node:18-alpine\n\n# 作業ディレクトリの設定\nWORKDIR /app\n\n# package.json と package-lock.json をコピー\nCOPY package*.json ./\n\n# 依存関係のインストール\nRUN npm ci --only=production\n\n# アプリケーションのソースコードをコピー\nCOPY . .\n\n# ポートの公開\nEXPOSE 3000\n\n# アプリケーションの起動\nCMD [&quot;npm&quot;, &quot;start&quot;]\n</code></pre>\n<h2 id=\"マルチステージビルド\">マルチステージビルド</h2><p>本番用イメージのサイズを小さくするテクニック：</p>\n<pre><code class=\"language-dockerfile\"># ビルドステージ\nFROM node:18 AS builder\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nRUN npm run build\n\n# 実行ステージ\nFROM node:18-alpine\nWORKDIR /app\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY package*.json ./\nEXPOSE 3000\nCMD [&quot;node&quot;, &quot;dist/index.js&quot;]\n</code></pre>\n<h2 id=\"docker-composeの活用\">Docker Composeの活用</h2><p>複数のコンテナを管理するための<code>docker-compose.yml</code>：</p>\n<pre><code class=\"language-yaml\">version: &#39;3.8&#39;\n\nservices:\n  web:\n    build: .\n    ports:\n      - &quot;3000:3000&quot;\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=postgresql://db:5432/myapp\n    depends_on:\n      - db\n    volumes:\n      - ./logs:/app/logs\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_USER=admin\n      - POSTGRES_PASSWORD=secret\n      - POSTGRES_DB=myapp\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n</code></pre>\n<h2 id=\"よく使うdockerコマンド\">よく使うDockerコマンド</h2><pre><code class=\"language-bash\"># イメージのビルド\ndocker build -t myapp:latest .\n\n# コンテナの起動\ndocker run -d -p 3000:3000 --name myapp myapp:latest\n\n# 実行中のコンテナの確認\ndocker ps\n\n# コンテナのログ確認\ndocker logs myapp\n\n# コンテナに入る\ndocker exec -it myapp sh\n\n# コンテナの停止\ndocker stop myapp\n\n# コンテナの削除\ndocker rm myapp\n\n# イメージの削除\ndocker rmi myapp:latest\n\n# Docker Composeでサービスを起動\ndocker-compose up -d\n\n# Docker Composeでサービスを停止\ndocker-compose down\n</code></pre>\n<h2 id=\"ベストプラクティス\">ベストプラクティス</h2><h3 id=\"1-レイヤーを最適化する\">1. レイヤーを最適化する</h3><p>変更頻度の低いコマンドを先に実行：</p>\n<pre><code class=\"language-dockerfile\"># ✅ Good\nCOPY package*.json ./\nRUN npm install\nCOPY . .\n\n# ❌ Bad\nCOPY . .\nRUN npm install\n</code></pre>\n<h3 id=\"2-dockerignoreを活用する\">2. .dockerignoreを活用する</h3><p>不要なファイルをイメージに含めない：</p>\n<pre><code>node_modules\nnpm-debug.log\n.git\n.gitignore\n.env\n*.md\n</code></pre>\n<h3 id=\"3-軽量なベースイメージを使用する\">3. 軽量なベースイメージを使用する</h3><pre><code class=\"language-dockerfile\"># ✅ Alpine版を使用（サイズが小さい）\nFROM node:18-alpine\n\n# ❌ 通常版（サイズが大きい）\nFROM node:18\n</code></pre>\n<h3 id=\"4-セキュリティ対策\">4. セキュリティ対策</h3><pre><code class=\"language-dockerfile\"># 非rootユーザーで実行\nFROM node:18-alpine\n\nRUN addgroup -g 1001 -S nodejs &amp;&amp; \\\n    adduser -S nodejs -u 1001\n\nUSER nodejs\n\nWORKDIR /app\nCOPY --chown=nodejs:nodejs . .\n\nCMD [&quot;node&quot;, &quot;index.js&quot;]\n</code></pre>\n<h2 id=\"イメージサイズの比較\">イメージサイズの比較</h2><table>\n<thead>\n<tr>\n<th>ベースイメージ</th>\n<th>サイズ</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>node:18</td>\n<td>~900 MB</td>\n</tr>\n<tr>\n<td>node:18-slim</td>\n<td>~200 MB</td>\n</tr>\n<tr>\n<td>node:18-alpine</td>\n<td>~170 MB</td>\n</tr>\n</tbody></table>\n<h2 id=\"トラブルシューティング\">トラブルシューティング</h2><h3 id=\"コンテナが起動しない\">コンテナが起動しない</h3><pre><code class=\"language-bash\"># ログを確認\ndocker logs &lt;container_id&gt;\n\n# コンテナ内に入って調査\ndocker exec -it &lt;container_id&gt; sh\n</code></pre>\n<h3 id=\"ボリュームのデータが消えた\">ボリュームのデータが消えた</h3><pre><code class=\"language-bash\"># 名前付きボリュームを使用\ndocker volume create mydata\ndocker run -v mydata:/data myapp\n\n# ボリュームの一覧\ndocker volume ls\n</code></pre>\n<h3 id=\"ネットワークの問題\">ネットワークの問題</h3><pre><code class=\"language-bash\"># ネットワークの作成\ndocker network create mynetwork\n\n# ネットワークに接続してコンテナを起動\ndocker run --network mynetwork myapp\n</code></pre>\n<h2 id=\"まとめ\">まとめ</h2><p>Dockerは現代の開発に欠かせないツールです。基本をしっかり理解し、ベストプラクティスに従うことで、効率的な開発環境を構築できます。</p>\n<p>次のステップ：</p>\n<ul>\n<li>Kubernetesでのオーケストレーション</li>\n<li>CI/CDパイプラインへの統合</li>\n<li>セキュリティスキャンの導入</li>\n</ul>\n",
  "modifiedDate": "2025-11-16T14:45:05.161Z"
}