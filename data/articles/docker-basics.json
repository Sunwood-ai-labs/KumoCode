{
  "filename": "docker-basics.md",
  "title": "Docker基礎 - コンテナ技術入門",
  "content": "---\ntitle: Docker基礎 - コンテナ技術入門\ndate: 2025-11-08\ntags: [Docker, DevOps, Container]\n---\n\n# Docker基礎 - コンテナ技術入門\n\nDockerは、アプリケーションをコンテナとしてパッケージ化し、どの環境でも同じように実行できるようにするプラットフォームです。\n\n## Dockerとは？\n\nDockerを使うことで、開発環境と本番環境の差異をなくし、「私の環境では動くのに」問題を解決できます。\n\n### 主な概念\n\n- **イメージ**: アプリケーションとその依存関係をパッケージ化したもの\n- **コンテナ**: イメージから作成された実行可能なインスタンス\n- **Dockerfile**: イメージを構築するための設計図\n- **Docker Hub**: イメージの公開リポジトリ\n\n## Dockerfileの書き方\n\n基本的なDockerfileの例：\n\n```dockerfile\n# ベースイメージ\nFROM node:18-alpine\n\n# 作業ディレクトリの設定\nWORKDIR /app\n\n# package.json と package-lock.json をコピー\nCOPY package*.json ./\n\n# 依存関係のインストール\nRUN npm ci --only=production\n\n# アプリケーションのソースコードをコピー\nCOPY . .\n\n# ポートの公開\nEXPOSE 3000\n\n# アプリケーションの起動\nCMD [\"npm\", \"start\"]\n```\n\n## マルチステージビルド\n\n本番用イメージのサイズを小さくするテクニック：\n\n```dockerfile\n# ビルドステージ\nFROM node:18 AS builder\nWORKDIR /app\nCOPY package*.json ./\nRUN npm install\nCOPY . .\nRUN npm run build\n\n# 実行ステージ\nFROM node:18-alpine\nWORKDIR /app\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY package*.json ./\nEXPOSE 3000\nCMD [\"node\", \"dist/index.js\"]\n```\n\n## Docker Composeの活用\n\n複数のコンテナを管理するための`docker-compose.yml`：\n\n```yaml\nversion: '3.8'\n\nservices:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=postgresql://db:5432/myapp\n    depends_on:\n      - db\n    volumes:\n      - ./logs:/app/logs\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_USER=admin\n      - POSTGRES_PASSWORD=secret\n      - POSTGRES_DB=myapp\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n```\n\n## よく使うDockerコマンド\n\n```bash\n# イメージのビルド\ndocker build -t myapp:latest .\n\n# コンテナの起動\ndocker run -d -p 3000:3000 --name myapp myapp:latest\n\n# 実行中のコンテナの確認\ndocker ps\n\n# コンテナのログ確認\ndocker logs myapp\n\n# コンテナに入る\ndocker exec -it myapp sh\n\n# コンテナの停止\ndocker stop myapp\n\n# コンテナの削除\ndocker rm myapp\n\n# イメージの削除\ndocker rmi myapp:latest\n\n# Docker Composeでサービスを起動\ndocker-compose up -d\n\n# Docker Composeでサービスを停止\ndocker-compose down\n```\n\n## ベストプラクティス\n\n### 1. レイヤーを最適化する\n\n変更頻度の低いコマンドを先に実行：\n\n```dockerfile\n# ✅ Good\nCOPY package*.json ./\nRUN npm install\nCOPY . .\n\n# ❌ Bad\nCOPY . .\nRUN npm install\n```\n\n### 2. .dockerignoreを活用する\n\n不要なファイルをイメージに含めない：\n\n```\nnode_modules\nnpm-debug.log\n.git\n.gitignore\n.env\n*.md\n```\n\n### 3. 軽量なベースイメージを使用する\n\n```dockerfile\n# ✅ Alpine版を使用（サイズが小さい）\nFROM node:18-alpine\n\n# ❌ 通常版（サイズが大きい）\nFROM node:18\n```\n\n### 4. セキュリティ対策\n\n```dockerfile\n# 非rootユーザーで実行\nFROM node:18-alpine\n\nRUN addgroup -g 1001 -S nodejs && \\\n    adduser -S nodejs -u 1001\n\nUSER nodejs\n\nWORKDIR /app\nCOPY --chown=nodejs:nodejs . .\n\nCMD [\"node\", \"index.js\"]\n```\n\n## イメージサイズの比較\n\n| ベースイメージ | サイズ |\n|--------------|--------|\n| node:18 | ~900 MB |\n| node:18-slim | ~200 MB |\n| node:18-alpine | ~170 MB |\n\n## トラブルシューティング\n\n### コンテナが起動しない\n\n```bash\n# ログを確認\ndocker logs <container_id>\n\n# コンテナ内に入って調査\ndocker exec -it <container_id> sh\n```\n\n### ボリュームのデータが消えた\n\n```bash\n# 名前付きボリュームを使用\ndocker volume create mydata\ndocker run -v mydata:/data myapp\n\n# ボリュームの一覧\ndocker volume ls\n```\n\n### ネットワークの問題\n\n```bash\n# ネットワークの作成\ndocker network create mynetwork\n\n# ネットワークに接続してコンテナを起動\ndocker run --network mynetwork myapp\n```\n\n## まとめ\n\nDockerは現代の開発に欠かせないツールです。基本をしっかり理解し、ベストプラクティスに従うことで、効率的な開発環境を構築できます。\n\n次のステップ：\n- Kubernetesでのオーケストレーション\n- CI/CDパイプラインへの統合\n- セキュリティスキャンの導入\n",
  "modifiedDate": "2025-11-16T12:26:30.256Z"
}